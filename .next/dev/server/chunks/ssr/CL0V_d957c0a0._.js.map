{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/daibbar/projects/CL0V/actions/student-portal-actions.ts"],"sourcesContent":["'use server'\n\nimport db from '@/lib/db';\nimport { auth } from '@/auth';\nimport { revalidatePath } from 'next/cache';\nimport bcrypt from 'bcryptjs';\n\n// --- HELPERS ---\nasync function getStudentId() {\n  const session = await auth();\n  if (!session?.user?.id || (session.user as any).role !== 'student') {\n    throw new Error('Unauthorized');\n  }\n  return parseInt(session.user.id);\n}\n\n// --- READ ---\n\nexport async function getAllEventsForStudent() {\n  const studentId = await getStudentId();\n  try {\n    const events = db.prepare(`\n      SELECT e.*, \n        CASE WHEN ep.studentId IS NOT NULL THEN 1 ELSE 0 END as isRegistered\n      FROM events e\n      LEFT JOIN eventParticipants ep ON e.eventId = ep.eventId AND ep.studentId = ?\n      ORDER BY e.startDate DESC\n    `).all(studentId);\n    return events;\n  } catch (error) {\n    console.error(\"Failed to fetch events:\", error);\n    return [];\n  }\n}\n\nexport async function getAllClubsForStudent() {\n  const studentId = await getStudentId();\n  try {\n    const clubs = db.prepare(`\n      SELECT c.*, \n        CASE WHEN cm.studentId IS NOT NULL THEN 1 ELSE 0 END as isMember,\n        cm.status as membershipStatus\n      FROM clubs c\n      LEFT JOIN clubMemberships cm ON c.clubId = cm.clubId AND cm.studentId = ?\n      ORDER BY c.clubName ASC\n    `).all(studentId);\n    return clubs;\n  } catch (error) {\n    console.error(\"Failed to fetch clubs:\", error);\n    return [];\n  }\n}\n\nexport async function getAllActivitiesForStudent() {\n  const studentId = await getStudentId();\n  try {\n    const activities = db.prepare(`\n      SELECT a.*, \n        CASE WHEN r.studentId IS NOT NULL THEN 1 ELSE 0 END as isRegistered\n      FROM activities a\n      LEFT JOIN registrations r ON a.activityId = r.activityId AND r.studentId = ?\n      ORDER BY a.startDate DESC\n    `).all(studentId);\n    return activities;\n  } catch (error) {\n    console.error(\"Failed to fetch activities:\", error);\n    return [];\n  }\n}\n\n// --- WRITE ---\n\nexport async function registerForEvent(eventId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('INSERT INTO eventParticipants (eventId, studentId) VALUES (?, ?)').run(eventId, studentId);\n    revalidatePath('/student/events');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Registered successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function unregisterFromEvent(eventId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('DELETE FROM eventParticipants WHERE eventId = ? AND studentId = ?').run(eventId, studentId);\n    revalidatePath('/student/events');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Unregistered successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function joinClub(clubId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('INSERT INTO clubMemberships (clubId, studentId, status) VALUES (?, ?, ?)').run(clubId, studentId, 'pending');\n    revalidatePath('/student/clubs');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Request to join club sent. Awaiting approval.' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function leaveClub(clubId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('DELETE FROM clubMemberships WHERE clubId = ? AND studentId = ?').run(clubId, studentId);\n    revalidatePath('/student/clubs');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Left club successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function registerForActivity(activityId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('INSERT INTO registrations (activityId, studentId) VALUES (?, ?)').run(activityId, studentId);\n    revalidatePath('/student/activities');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Registered for activity successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function unregisterFromActivity(activityId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('DELETE FROM registrations WHERE activityId = ? AND studentId = ?').run(activityId, studentId);\n    revalidatePath('/student/activities');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Unregistered from activity successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function changePassword(formData: FormData) {\n  const studentId = await getStudentId();\n  const currentPassword = formData.get('currentPassword') as string;\n  const newPassword = formData.get('newPassword') as string;\n\n  try {\n    const student = db.prepare('SELECT * FROM students WHERE studentId = ?').get(studentId) as any;\n    \n    const match = await bcrypt.compare(currentPassword, student.password);\n    if (!match) {\n      return { success: false, message: 'Incorrect current password' };\n    }\n\n    const hashed = await bcrypt.hash(newPassword, 10);\n    db.prepare('UPDATE students SET password = ? WHERE studentId = ?').run(hashed, studentId);\n    \n    return { success: true, message: 'Password changed successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n"],"names":[],"mappings":";;;;;;;IAwEsB,mBAAA,WAAA,GAAA,IAAA,uXAAA,EAAA,8CAAA,4WAAA,EAAA,KAAA,GAAA,kXAAA,EAAA"}},
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///home/daibbar/projects/CL0V/actions/student-portal-actions.ts"],"sourcesContent":["'use server'\n\nimport db from '@/lib/db';\nimport { auth } from '@/auth';\nimport { revalidatePath } from 'next/cache';\nimport bcrypt from 'bcryptjs';\n\n// --- HELPERS ---\nasync function getStudentId() {\n  const session = await auth();\n  if (!session?.user?.id || (session.user as any).role !== 'student') {\n    throw new Error('Unauthorized');\n  }\n  return parseInt(session.user.id);\n}\n\n// --- READ ---\n\nexport async function getAllEventsForStudent() {\n  const studentId = await getStudentId();\n  try {\n    const events = db.prepare(`\n      SELECT e.*, \n        CASE WHEN ep.studentId IS NOT NULL THEN 1 ELSE 0 END as isRegistered\n      FROM events e\n      LEFT JOIN eventParticipants ep ON e.eventId = ep.eventId AND ep.studentId = ?\n      ORDER BY e.startDate DESC\n    `).all(studentId);\n    return events;\n  } catch (error) {\n    console.error(\"Failed to fetch events:\", error);\n    return [];\n  }\n}\n\nexport async function getAllClubsForStudent() {\n  const studentId = await getStudentId();\n  try {\n    const clubs = db.prepare(`\n      SELECT c.*, \n        CASE WHEN cm.studentId IS NOT NULL THEN 1 ELSE 0 END as isMember,\n        cm.status as membershipStatus\n      FROM clubs c\n      LEFT JOIN clubMemberships cm ON c.clubId = cm.clubId AND cm.studentId = ?\n      ORDER BY c.clubName ASC\n    `).all(studentId);\n    return clubs;\n  } catch (error) {\n    console.error(\"Failed to fetch clubs:\", error);\n    return [];\n  }\n}\n\nexport async function getAllActivitiesForStudent() {\n  const studentId = await getStudentId();\n  try {\n    const activities = db.prepare(`\n      SELECT a.*, \n        CASE WHEN r.studentId IS NOT NULL THEN 1 ELSE 0 END as isRegistered\n      FROM activities a\n      LEFT JOIN registrations r ON a.activityId = r.activityId AND r.studentId = ?\n      ORDER BY a.startDate DESC\n    `).all(studentId);\n    return activities;\n  } catch (error) {\n    console.error(\"Failed to fetch activities:\", error);\n    return [];\n  }\n}\n\n// --- WRITE ---\n\nexport async function registerForEvent(eventId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('INSERT INTO eventParticipants (eventId, studentId) VALUES (?, ?)').run(eventId, studentId);\n    revalidatePath('/student/events');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Registered successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function unregisterFromEvent(eventId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('DELETE FROM eventParticipants WHERE eventId = ? AND studentId = ?').run(eventId, studentId);\n    revalidatePath('/student/events');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Unregistered successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function joinClub(clubId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('INSERT INTO clubMemberships (clubId, studentId, status) VALUES (?, ?, ?)').run(clubId, studentId, 'pending');\n    revalidatePath('/student/clubs');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Request to join club sent. Awaiting approval.' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function leaveClub(clubId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('DELETE FROM clubMemberships WHERE clubId = ? AND studentId = ?').run(clubId, studentId);\n    revalidatePath('/student/clubs');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Left club successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function registerForActivity(activityId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('INSERT INTO registrations (activityId, studentId) VALUES (?, ?)').run(activityId, studentId);\n    revalidatePath('/student/activities');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Registered for activity successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function unregisterFromActivity(activityId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('DELETE FROM registrations WHERE activityId = ? AND studentId = ?').run(activityId, studentId);\n    revalidatePath('/student/activities');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Unregistered from activity successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function changePassword(formData: FormData) {\n  const studentId = await getStudentId();\n  const currentPassword = formData.get('currentPassword') as string;\n  const newPassword = formData.get('newPassword') as string;\n\n  try {\n    const student = db.prepare('SELECT * FROM students WHERE studentId = ?').get(studentId) as any;\n    \n    const match = await bcrypt.compare(currentPassword, student.password);\n    if (!match) {\n      return { success: false, message: 'Incorrect current password' };\n    }\n\n    const hashed = await bcrypt.hash(newPassword, 10);\n    db.prepare('UPDATE students SET password = ? WHERE studentId = ?').run(hashed, studentId);\n    \n    return { success: true, message: 'Password changed successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n"],"names":[],"mappings":";;;;;;;IAoFsB,sBAAA,WAAA,GAAA,IAAA,uXAAA,EAAA,8CAAA,4WAAA,EAAA,KAAA,GAAA,kXAAA,EAAA"}},
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///home/daibbar/projects/CL0V/actions/student-portal-actions.ts"],"sourcesContent":["'use server'\n\nimport db from '@/lib/db';\nimport { auth } from '@/auth';\nimport { revalidatePath } from 'next/cache';\nimport bcrypt from 'bcryptjs';\n\n// --- HELPERS ---\nasync function getStudentId() {\n  const session = await auth();\n  if (!session?.user?.id || (session.user as any).role !== 'student') {\n    throw new Error('Unauthorized');\n  }\n  return parseInt(session.user.id);\n}\n\n// --- READ ---\n\nexport async function getAllEventsForStudent() {\n  const studentId = await getStudentId();\n  try {\n    const events = db.prepare(`\n      SELECT e.*, \n        CASE WHEN ep.studentId IS NOT NULL THEN 1 ELSE 0 END as isRegistered\n      FROM events e\n      LEFT JOIN eventParticipants ep ON e.eventId = ep.eventId AND ep.studentId = ?\n      ORDER BY e.startDate DESC\n    `).all(studentId);\n    return events;\n  } catch (error) {\n    console.error(\"Failed to fetch events:\", error);\n    return [];\n  }\n}\n\nexport async function getAllClubsForStudent() {\n  const studentId = await getStudentId();\n  try {\n    const clubs = db.prepare(`\n      SELECT c.*, \n        CASE WHEN cm.studentId IS NOT NULL THEN 1 ELSE 0 END as isMember,\n        cm.status as membershipStatus\n      FROM clubs c\n      LEFT JOIN clubMemberships cm ON c.clubId = cm.clubId AND cm.studentId = ?\n      ORDER BY c.clubName ASC\n    `).all(studentId);\n    return clubs;\n  } catch (error) {\n    console.error(\"Failed to fetch clubs:\", error);\n    return [];\n  }\n}\n\nexport async function getAllActivitiesForStudent() {\n  const studentId = await getStudentId();\n  try {\n    const activities = db.prepare(`\n      SELECT a.*, \n        CASE WHEN r.studentId IS NOT NULL THEN 1 ELSE 0 END as isRegistered\n      FROM activities a\n      LEFT JOIN registrations r ON a.activityId = r.activityId AND r.studentId = ?\n      ORDER BY a.startDate DESC\n    `).all(studentId);\n    return activities;\n  } catch (error) {\n    console.error(\"Failed to fetch activities:\", error);\n    return [];\n  }\n}\n\n// --- WRITE ---\n\nexport async function registerForEvent(eventId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('INSERT INTO eventParticipants (eventId, studentId) VALUES (?, ?)').run(eventId, studentId);\n    revalidatePath('/student/events');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Registered successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function unregisterFromEvent(eventId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('DELETE FROM eventParticipants WHERE eventId = ? AND studentId = ?').run(eventId, studentId);\n    revalidatePath('/student/events');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Unregistered successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function joinClub(clubId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('INSERT INTO clubMemberships (clubId, studentId, status) VALUES (?, ?, ?)').run(clubId, studentId, 'pending');\n    revalidatePath('/student/clubs');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Request to join club sent. Awaiting approval.' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function leaveClub(clubId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('DELETE FROM clubMemberships WHERE clubId = ? AND studentId = ?').run(clubId, studentId);\n    revalidatePath('/student/clubs');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Left club successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function registerForActivity(activityId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('INSERT INTO registrations (activityId, studentId) VALUES (?, ?)').run(activityId, studentId);\n    revalidatePath('/student/activities');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Registered for activity successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function unregisterFromActivity(activityId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('DELETE FROM registrations WHERE activityId = ? AND studentId = ?').run(activityId, studentId);\n    revalidatePath('/student/activities');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Unregistered from activity successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function changePassword(formData: FormData) {\n  const studentId = await getStudentId();\n  const currentPassword = formData.get('currentPassword') as string;\n  const newPassword = formData.get('newPassword') as string;\n\n  try {\n    const student = db.prepare('SELECT * FROM students WHERE studentId = ?').get(studentId) as any;\n    \n    const match = await bcrypt.compare(currentPassword, student.password);\n    if (!match) {\n      return { success: false, message: 'Incorrect current password' };\n    }\n\n    const hashed = await bcrypt.hash(newPassword, 10);\n    db.prepare('UPDATE students SET password = ? WHERE studentId = ?').run(hashed, studentId);\n    \n    return { success: true, message: 'Password changed successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n"],"names":[],"mappings":";;;;;;;IAgGsB,WAAA,WAAA,GAAA,IAAA,uXAAA,EAAA,8CAAA,4WAAA,EAAA,KAAA,GAAA,kXAAA,EAAA"}},
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///home/daibbar/projects/CL0V/actions/student-portal-actions.ts"],"sourcesContent":["'use server'\n\nimport db from '@/lib/db';\nimport { auth } from '@/auth';\nimport { revalidatePath } from 'next/cache';\nimport bcrypt from 'bcryptjs';\n\n// --- HELPERS ---\nasync function getStudentId() {\n  const session = await auth();\n  if (!session?.user?.id || (session.user as any).role !== 'student') {\n    throw new Error('Unauthorized');\n  }\n  return parseInt(session.user.id);\n}\n\n// --- READ ---\n\nexport async function getAllEventsForStudent() {\n  const studentId = await getStudentId();\n  try {\n    const events = db.prepare(`\n      SELECT e.*, \n        CASE WHEN ep.studentId IS NOT NULL THEN 1 ELSE 0 END as isRegistered\n      FROM events e\n      LEFT JOIN eventParticipants ep ON e.eventId = ep.eventId AND ep.studentId = ?\n      ORDER BY e.startDate DESC\n    `).all(studentId);\n    return events;\n  } catch (error) {\n    console.error(\"Failed to fetch events:\", error);\n    return [];\n  }\n}\n\nexport async function getAllClubsForStudent() {\n  const studentId = await getStudentId();\n  try {\n    const clubs = db.prepare(`\n      SELECT c.*, \n        CASE WHEN cm.studentId IS NOT NULL THEN 1 ELSE 0 END as isMember,\n        cm.status as membershipStatus\n      FROM clubs c\n      LEFT JOIN clubMemberships cm ON c.clubId = cm.clubId AND cm.studentId = ?\n      ORDER BY c.clubName ASC\n    `).all(studentId);\n    return clubs;\n  } catch (error) {\n    console.error(\"Failed to fetch clubs:\", error);\n    return [];\n  }\n}\n\nexport async function getAllActivitiesForStudent() {\n  const studentId = await getStudentId();\n  try {\n    const activities = db.prepare(`\n      SELECT a.*, \n        CASE WHEN r.studentId IS NOT NULL THEN 1 ELSE 0 END as isRegistered\n      FROM activities a\n      LEFT JOIN registrations r ON a.activityId = r.activityId AND r.studentId = ?\n      ORDER BY a.startDate DESC\n    `).all(studentId);\n    return activities;\n  } catch (error) {\n    console.error(\"Failed to fetch activities:\", error);\n    return [];\n  }\n}\n\n// --- WRITE ---\n\nexport async function registerForEvent(eventId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('INSERT INTO eventParticipants (eventId, studentId) VALUES (?, ?)').run(eventId, studentId);\n    revalidatePath('/student/events');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Registered successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function unregisterFromEvent(eventId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('DELETE FROM eventParticipants WHERE eventId = ? AND studentId = ?').run(eventId, studentId);\n    revalidatePath('/student/events');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Unregistered successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function joinClub(clubId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('INSERT INTO clubMemberships (clubId, studentId, status) VALUES (?, ?, ?)').run(clubId, studentId, 'pending');\n    revalidatePath('/student/clubs');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Request to join club sent. Awaiting approval.' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function leaveClub(clubId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('DELETE FROM clubMemberships WHERE clubId = ? AND studentId = ?').run(clubId, studentId);\n    revalidatePath('/student/clubs');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Left club successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function registerForActivity(activityId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('INSERT INTO registrations (activityId, studentId) VALUES (?, ?)').run(activityId, studentId);\n    revalidatePath('/student/activities');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Registered for activity successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function unregisterFromActivity(activityId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('DELETE FROM registrations WHERE activityId = ? AND studentId = ?').run(activityId, studentId);\n    revalidatePath('/student/activities');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Unregistered from activity successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function changePassword(formData: FormData) {\n  const studentId = await getStudentId();\n  const currentPassword = formData.get('currentPassword') as string;\n  const newPassword = formData.get('newPassword') as string;\n\n  try {\n    const student = db.prepare('SELECT * FROM students WHERE studentId = ?').get(studentId) as any;\n    \n    const match = await bcrypt.compare(currentPassword, student.password);\n    if (!match) {\n      return { success: false, message: 'Incorrect current password' };\n    }\n\n    const hashed = await bcrypt.hash(newPassword, 10);\n    db.prepare('UPDATE students SET password = ? WHERE studentId = ?').run(hashed, studentId);\n    \n    return { success: true, message: 'Password changed successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n"],"names":[],"mappings":";;;;;;;IA4GsB,YAAA,WAAA,GAAA,IAAA,uXAAA,EAAA,8CAAA,4WAAA,EAAA,KAAA,GAAA,kXAAA,EAAA"}},
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///home/daibbar/projects/CL0V/actions/student-portal-actions.ts"],"sourcesContent":["'use server'\n\nimport db from '@/lib/db';\nimport { auth } from '@/auth';\nimport { revalidatePath } from 'next/cache';\nimport bcrypt from 'bcryptjs';\n\n// --- HELPERS ---\nasync function getStudentId() {\n  const session = await auth();\n  if (!session?.user?.id || (session.user as any).role !== 'student') {\n    throw new Error('Unauthorized');\n  }\n  return parseInt(session.user.id);\n}\n\n// --- READ ---\n\nexport async function getAllEventsForStudent() {\n  const studentId = await getStudentId();\n  try {\n    const events = db.prepare(`\n      SELECT e.*, \n        CASE WHEN ep.studentId IS NOT NULL THEN 1 ELSE 0 END as isRegistered\n      FROM events e\n      LEFT JOIN eventParticipants ep ON e.eventId = ep.eventId AND ep.studentId = ?\n      ORDER BY e.startDate DESC\n    `).all(studentId);\n    return events;\n  } catch (error) {\n    console.error(\"Failed to fetch events:\", error);\n    return [];\n  }\n}\n\nexport async function getAllClubsForStudent() {\n  const studentId = await getStudentId();\n  try {\n    const clubs = db.prepare(`\n      SELECT c.*, \n        CASE WHEN cm.studentId IS NOT NULL THEN 1 ELSE 0 END as isMember,\n        cm.status as membershipStatus\n      FROM clubs c\n      LEFT JOIN clubMemberships cm ON c.clubId = cm.clubId AND cm.studentId = ?\n      ORDER BY c.clubName ASC\n    `).all(studentId);\n    return clubs;\n  } catch (error) {\n    console.error(\"Failed to fetch clubs:\", error);\n    return [];\n  }\n}\n\nexport async function getAllActivitiesForStudent() {\n  const studentId = await getStudentId();\n  try {\n    const activities = db.prepare(`\n      SELECT a.*, \n        CASE WHEN r.studentId IS NOT NULL THEN 1 ELSE 0 END as isRegistered\n      FROM activities a\n      LEFT JOIN registrations r ON a.activityId = r.activityId AND r.studentId = ?\n      ORDER BY a.startDate DESC\n    `).all(studentId);\n    return activities;\n  } catch (error) {\n    console.error(\"Failed to fetch activities:\", error);\n    return [];\n  }\n}\n\n// --- WRITE ---\n\nexport async function registerForEvent(eventId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('INSERT INTO eventParticipants (eventId, studentId) VALUES (?, ?)').run(eventId, studentId);\n    revalidatePath('/student/events');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Registered successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function unregisterFromEvent(eventId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('DELETE FROM eventParticipants WHERE eventId = ? AND studentId = ?').run(eventId, studentId);\n    revalidatePath('/student/events');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Unregistered successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function joinClub(clubId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('INSERT INTO clubMemberships (clubId, studentId, status) VALUES (?, ?, ?)').run(clubId, studentId, 'pending');\n    revalidatePath('/student/clubs');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Request to join club sent. Awaiting approval.' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function leaveClub(clubId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('DELETE FROM clubMemberships WHERE clubId = ? AND studentId = ?').run(clubId, studentId);\n    revalidatePath('/student/clubs');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Left club successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function registerForActivity(activityId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('INSERT INTO registrations (activityId, studentId) VALUES (?, ?)').run(activityId, studentId);\n    revalidatePath('/student/activities');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Registered for activity successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function unregisterFromActivity(activityId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('DELETE FROM registrations WHERE activityId = ? AND studentId = ?').run(activityId, studentId);\n    revalidatePath('/student/activities');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Unregistered from activity successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function changePassword(formData: FormData) {\n  const studentId = await getStudentId();\n  const currentPassword = formData.get('currentPassword') as string;\n  const newPassword = formData.get('newPassword') as string;\n\n  try {\n    const student = db.prepare('SELECT * FROM students WHERE studentId = ?').get(studentId) as any;\n    \n    const match = await bcrypt.compare(currentPassword, student.password);\n    if (!match) {\n      return { success: false, message: 'Incorrect current password' };\n    }\n\n    const hashed = await bcrypt.hash(newPassword, 10);\n    db.prepare('UPDATE students SET password = ? WHERE studentId = ?').run(hashed, studentId);\n    \n    return { success: true, message: 'Password changed successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n"],"names":[],"mappings":";;;;;;;IAwHsB,sBAAA,WAAA,GAAA,IAAA,uXAAA,EAAA,8CAAA,4WAAA,EAAA,KAAA,GAAA,kXAAA,EAAA"}},
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///home/daibbar/projects/CL0V/actions/student-portal-actions.ts"],"sourcesContent":["'use server'\n\nimport db from '@/lib/db';\nimport { auth } from '@/auth';\nimport { revalidatePath } from 'next/cache';\nimport bcrypt from 'bcryptjs';\n\n// --- HELPERS ---\nasync function getStudentId() {\n  const session = await auth();\n  if (!session?.user?.id || (session.user as any).role !== 'student') {\n    throw new Error('Unauthorized');\n  }\n  return parseInt(session.user.id);\n}\n\n// --- READ ---\n\nexport async function getAllEventsForStudent() {\n  const studentId = await getStudentId();\n  try {\n    const events = db.prepare(`\n      SELECT e.*, \n        CASE WHEN ep.studentId IS NOT NULL THEN 1 ELSE 0 END as isRegistered\n      FROM events e\n      LEFT JOIN eventParticipants ep ON e.eventId = ep.eventId AND ep.studentId = ?\n      ORDER BY e.startDate DESC\n    `).all(studentId);\n    return events;\n  } catch (error) {\n    console.error(\"Failed to fetch events:\", error);\n    return [];\n  }\n}\n\nexport async function getAllClubsForStudent() {\n  const studentId = await getStudentId();\n  try {\n    const clubs = db.prepare(`\n      SELECT c.*, \n        CASE WHEN cm.studentId IS NOT NULL THEN 1 ELSE 0 END as isMember,\n        cm.status as membershipStatus\n      FROM clubs c\n      LEFT JOIN clubMemberships cm ON c.clubId = cm.clubId AND cm.studentId = ?\n      ORDER BY c.clubName ASC\n    `).all(studentId);\n    return clubs;\n  } catch (error) {\n    console.error(\"Failed to fetch clubs:\", error);\n    return [];\n  }\n}\n\nexport async function getAllActivitiesForStudent() {\n  const studentId = await getStudentId();\n  try {\n    const activities = db.prepare(`\n      SELECT a.*, \n        CASE WHEN r.studentId IS NOT NULL THEN 1 ELSE 0 END as isRegistered\n      FROM activities a\n      LEFT JOIN registrations r ON a.activityId = r.activityId AND r.studentId = ?\n      ORDER BY a.startDate DESC\n    `).all(studentId);\n    return activities;\n  } catch (error) {\n    console.error(\"Failed to fetch activities:\", error);\n    return [];\n  }\n}\n\n// --- WRITE ---\n\nexport async function registerForEvent(eventId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('INSERT INTO eventParticipants (eventId, studentId) VALUES (?, ?)').run(eventId, studentId);\n    revalidatePath('/student/events');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Registered successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function unregisterFromEvent(eventId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('DELETE FROM eventParticipants WHERE eventId = ? AND studentId = ?').run(eventId, studentId);\n    revalidatePath('/student/events');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Unregistered successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function joinClub(clubId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('INSERT INTO clubMemberships (clubId, studentId, status) VALUES (?, ?, ?)').run(clubId, studentId, 'pending');\n    revalidatePath('/student/clubs');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Request to join club sent. Awaiting approval.' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function leaveClub(clubId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('DELETE FROM clubMemberships WHERE clubId = ? AND studentId = ?').run(clubId, studentId);\n    revalidatePath('/student/clubs');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Left club successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function registerForActivity(activityId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('INSERT INTO registrations (activityId, studentId) VALUES (?, ?)').run(activityId, studentId);\n    revalidatePath('/student/activities');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Registered for activity successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function unregisterFromActivity(activityId: number) {\n  const studentId = await getStudentId();\n  try {\n    db.prepare('DELETE FROM registrations WHERE activityId = ? AND studentId = ?').run(activityId, studentId);\n    revalidatePath('/student/activities');\n    revalidatePath('/student/dashboard');\n    return { success: true, message: 'Unregistered from activity successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function changePassword(formData: FormData) {\n  const studentId = await getStudentId();\n  const currentPassword = formData.get('currentPassword') as string;\n  const newPassword = formData.get('newPassword') as string;\n\n  try {\n    const student = db.prepare('SELECT * FROM students WHERE studentId = ?').get(studentId) as any;\n    \n    const match = await bcrypt.compare(currentPassword, student.password);\n    if (!match) {\n      return { success: false, message: 'Incorrect current password' };\n    }\n\n    const hashed = await bcrypt.hash(newPassword, 10);\n    db.prepare('UPDATE students SET password = ? WHERE studentId = ?').run(hashed, studentId);\n    \n    return { success: true, message: 'Password changed successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n"],"names":[],"mappings":";;;;;;;IAoIsB,yBAAA,WAAA,GAAA,IAAA,uXAAA,EAAA,8CAAA,4WAAA,EAAA,KAAA,GAAA,kXAAA,EAAA"}},
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///home/daibbar/projects/CL0V/components/student-action-buttons.tsx"],"sourcesContent":["'use client';\n\nimport { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { useToast } from '@/hooks/use-toast';\nimport { \n  registerForEvent, unregisterFromEvent, \n  joinClub, leaveClub, \n  registerForActivity, unregisterFromActivity \n} from '@/actions/student-portal-actions';\nimport { Loader2 } from 'lucide-react';\n\ninterface ActionButtonProps {\n  id: number;\n  isActive: boolean;\n  type: 'event' | 'club' | 'activity';\n  status?: 'pending' | 'accepted' | 'rejected'; // Added status prop\n}\n\nexport function ActionButton({ id, isActive, type, status }: ActionButtonProps) {\n  const [loading, setLoading] = useState(false);\n  const { toast } = useToast();\n\n  const handleClick = async () => {\n    setLoading(true);\n    let result;\n    \n    if (type === 'event') {\n      result = isActive ? await unregisterFromEvent(id) : await registerForEvent(id);\n    } else if (type === 'club') {\n      // If pending, user might want to cancel request, which is same as leaving/deleting membership row\n      result = isActive ? await leaveClub(id) : await joinClub(id);\n    } else {\n      result = isActive ? await unregisterFromActivity(id) : await registerForActivity(id);\n    }\n\n    setLoading(false);\n\n    if (result.success) {\n      toast({\n        title: \"Success\",\n        description: result.message,\n      });\n    } else {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: result.message,\n      });\n    }\n  };\n\n  if (type === 'club' && isActive) {\n      if (status === 'pending') {\n          return (\n             <Button \n                onClick={handleClick} \n                variant=\"outline\"\n                disabled={loading}\n                className=\"border-yellow-500 text-yellow-600 hover:bg-yellow-50 hover:text-yellow-700\"\n             >\n                {loading && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                Pending Approval (Cancel)\n             </Button>\n          )\n      }\n      if (status === 'rejected') {\n          // Maybe allow re-apply? Or show rejected state. \n          // For now, let's treat it as \"Leave\" so they can delete the rejected row and try again later if logic allows.\n           return (\n             <Button \n                onClick={handleClick} \n                variant=\"outline\"\n                disabled={loading}\n                className=\"border-red-500 text-red-600 hover:bg-red-50 hover:text-red-700\"\n             >\n                {loading && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                Rejected (Dismiss)\n             </Button>\n          )\n      }\n  }\n\n  return (\n    <Button \n      onClick={handleClick} \n      variant={isActive ? \"outline\" : \"default\"}\n      disabled={loading}\n      className={isActive ? \"border-red-500 text-red-500 hover:bg-red-50 hover:text-red-600\" : \"\"}\n    >\n      {loading && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n      {isActive \n        ? (type === 'club' ? 'Leave' : 'Unregister') \n        : (type === 'club' ? 'Request to Join' : 'Register')}\n    </Button>\n  );\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AAVA;;;;;;;AAmBO,SAAS,aAAa,EAAE,EAAE,EAAE,QAAQ,EAAE,IAAI,EAAE,MAAM,EAAqB;IAC5E,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yVAAQ,EAAC;IACvC,MAAM,EAAE,KAAK,EAAE,GAAG,IAAA,yIAAQ;IAE1B,MAAM,cAAc;QAClB,WAAW;QACX,IAAI;QAEJ,IAAI,SAAS,SAAS;YACpB,SAAS,WAAW,MAAM,IAAA,8KAAmB,EAAC,MAAM,MAAM,IAAA,2KAAgB,EAAC;QAC7E,OAAO,IAAI,SAAS,QAAQ;YAC1B,kGAAkG;YAClG,SAAS,WAAW,MAAM,IAAA,oKAAS,EAAC,MAAM,MAAM,IAAA,mKAAQ,EAAC;QAC3D,OAAO;YACL,SAAS,WAAW,MAAM,IAAA,iLAAsB,EAAC,MAAM,MAAM,IAAA,8KAAmB,EAAC;QACnF;QAEA,WAAW;QAEX,IAAI,OAAO,OAAO,EAAE;YAClB,MAAM;gBACJ,OAAO;gBACP,aAAa,OAAO,OAAO;YAC7B;QACF,OAAO;YACL,MAAM;gBACJ,SAAS;gBACT,OAAO;gBACP,aAAa,OAAO,OAAO;YAC7B;QACF;IACF;IAEA,IAAI,SAAS,UAAU,UAAU;QAC7B,IAAI,WAAW,WAAW;YACtB,qBACG,sXAAC,6IAAM;gBACJ,SAAS;gBACT,SAAQ;gBACR,UAAU;gBACV,WAAU;;oBAET,yBAAW,sXAAC,wTAAO;wBAAC,WAAU;;;;;;oBAA+B;;;;;;;QAIxE;QACA,IAAI,WAAW,YAAY;YACvB,iDAAiD;YACjD,8GAA8G;YAC7G,qBACE,sXAAC,6IAAM;gBACJ,SAAS;gBACT,SAAQ;gBACR,UAAU;gBACV,WAAU;;oBAET,yBAAW,sXAAC,wTAAO;wBAAC,WAAU;;;;;;oBAA+B;;;;;;;QAIxE;IACJ;IAEA,qBACE,sXAAC,6IAAM;QACL,SAAS;QACT,SAAS,WAAW,YAAY;QAChC,UAAU;QACV,WAAW,WAAW,mEAAmE;;YAExF,yBAAW,sXAAC,wTAAO;gBAAC,WAAU;;;;;;YAC9B,WACI,SAAS,SAAS,UAAU,eAC5B,SAAS,SAAS,oBAAoB;;;;;;;AAGjD"}},
    {"offset": {"line": 199, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/CL0V/node_modules/.pnpm/lucide-react@0.454.0_react@19.2.0/node_modules/lucide-react/dist/esm/icons/loader-circle.js","sources":["file:///home/daibbar/projects/CL0V/node_modules/.pnpm/lucide-react%400.454.0_react%4019.2.0/node_modules/lucide-react/src/icons/loader-circle.ts"],"sourcesContent":["import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name LoaderCircle\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMjEgMTJhOSA5IDAgMSAxLTYuMjE5LTguNTYiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/loader-circle\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst LoaderCircle = createLucideIcon('LoaderCircle', [\n  ['path', { d: 'M21 12a9 9 0 1 1-6.219-8.56', key: '13zald' }],\n]);\n\nexport default LoaderCircle;\n"],"names":[],"mappings":";;;;;;;;;;;AAaM,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,KAAe,yQAAA,EAAiB,cAAgB,CAAA,CAAA,CAAA;IACpD;QAAC,CAAA,CAAA,CAAA,CAAA,CAAA,CAAQ,CAAA;QAAA,CAAA;YAAE,GAAG,CAA+B,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;YAAA,CAAA,CAAA,CAAA,CAAA,CAAK;QAAA,CAAU;KAAA;CAC7D,CAAA,CAAA"}}]
}