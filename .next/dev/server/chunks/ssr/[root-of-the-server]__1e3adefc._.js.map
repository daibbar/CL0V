{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///home/daibbar/projects/CL0V/lib/db.ts"],"sourcesContent":["import Database from 'better-sqlite3';\nimport path from 'path';\n\nconst dbPath = path.join(process.cwd(), 'data', 'cl0v.db');\n\nconst db = new Database(dbPath, { verbose: console.log});\n\ndb.pragma('foreign_keys = ON');\n\nexport default db;"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,SAAS,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,QAAQ;AAEhD,MAAM,KAAK,IAAI,sIAAQ,CAAC,QAAQ;IAAE,SAAS,QAAQ,GAAG;AAAA;AAEtD,GAAG,MAAM,CAAC;uCAEK"}},
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///home/daibbar/projects/CL0V/actions/student-actions.ts"],"sourcesContent":["'use server'\n\nimport db from '@/lib/db';\nimport { Student, Major } from '@/types/db';\nimport { revalidatePath } from 'next/cache';\n\n// --- HELPER TYPES ---\n// We define this here because the UI usually needs the Major Name, not just the ID\nexport type StudentWithMajor = Student & {\n  majorName: string | null;\n};\n\n// --- READ ---\n\nexport async function getStudents() {\n  // We JOIN with majors to get the readable name (e.g., 'IID') instead of just a number\n  const students = db.prepare(`\n    SELECT \n      students.*, \n      majors.majorName \n    FROM students \n    LEFT JOIN majors ON students.majorId = majors.majorId\n    ORDER BY students.lastName ASC\n  `).all() as StudentWithMajor[];\n  \n  return students;\n}\n\n// We need this to populate the <Select> dropdown in the Add/Edit form\nexport async function getMajors() {\n  return db.prepare('SELECT * FROM majors ORDER BY majorName ASC').all() as Major[];\n}\n\n// --- CREATE ---\n\nexport async function createStudent(formData: FormData) {\n  const firstName = formData.get('firstName') as string;\n  const lastName = formData.get('lastName') as string;\n  const cne = formData.get('cne') as string;\n  const email = formData.get('email') as string;\n  // Convert string \"1\" to number 1, or null if empty\n  const majorId = formData.get('majorId') ? parseInt(formData.get('majorId') as string) : null;\n\n  try {\n    const stmt = db.prepare(`\n      INSERT INTO students (firstName, lastName, cne, email, majorId)\n      VALUES (@firstName, @lastName, @cne, @email, @majorId)\n    `);\n\n    stmt.run({ firstName, lastName, cne, email, majorId });\n    \n    revalidatePath('/students');\n    return { success: true, message: 'Student registered successfully' };\n  } catch (error: any) {\n    // Handle Unique Constraints (Duplicate CNE or Email)\n    if (error.code === 'SQLITE_CONSTRAINT_UNIQUE') {\n      return { success: false, message: 'Error: Student Code (CNE) or Email already exists.' };\n    }\n    return { success: false, message: error.message };\n  }\n}\n\n// --- UPDATE ---\n\nexport async function updateStudent(studentId: number, formData: FormData) {\n  const firstName = formData.get('firstName') as string;\n  const lastName = formData.get('lastName') as string;\n  const cne = formData.get('cne') as string;\n  const email = formData.get('email') as string;\n  const majorId = formData.get('majorId') ? parseInt(formData.get('majorId') as string) : null;\n\n  try {\n    const stmt = db.prepare(`\n      UPDATE students \n      SET firstName = @firstName, \n          lastName = @lastName, \n          cne = @cne, \n          email = @email, \n          majorId = @majorId\n      WHERE studentId = @studentId\n    `);\n\n    stmt.run({ firstName, lastName, cne, email, majorId, studentId });\n\n    revalidatePath('/students');\n    return { success: true, message: 'Student updated successfully' };\n  } catch (error: any) {\n    if (error.code === 'SQLITE_CONSTRAINT_UNIQUE') {\n      return { success: false, message: 'Error: Student Code or Email is already taken.' };\n    }\n    return { success: false, message: error.message };\n  }\n}\n\n// --- DELETE ---\n\nexport async function deleteStudent(studentId: number) {\n  try {\n    const stmt = db.prepare('DELETE FROM students WHERE studentId = ?');\n    stmt.run(studentId);\n\n    revalidatePath('/students');\n    return { success: true, message: 'Student deleted successfully' };\n  } catch (error: any) {\n    // SQLITE_CONSTRAINT_FOREIGNKEY happens if you try to delete a student \n    // who is arguably an \"Organizer\" of an event or has critical linked data.\n    // (Though usually, ON DELETE CASCADE handles this, it's good to be safe)\n    return { success: false, message: error.message };\n  }\n}"],"names":[],"mappings":";;;;;;;;;;;;;AAEA;AAEA;;;;;AAUO,eAAe;IACpB,sFAAsF;IACtF,MAAM,WAAW,4HAAE,CAAC,OAAO,CAAC,CAAC;;;;;;;EAO7B,CAAC,EAAE,GAAG;IAEN,OAAO;AACT;AAGO,eAAe;IACpB,OAAO,4HAAE,CAAC,OAAO,CAAC,+CAA+C,GAAG;AACtE;AAIO,eAAe,cAAc,QAAkB;IACpD,MAAM,YAAY,SAAS,GAAG,CAAC;IAC/B,MAAM,WAAW,SAAS,GAAG,CAAC;IAC9B,MAAM,MAAM,SAAS,GAAG,CAAC;IACzB,MAAM,QAAQ,SAAS,GAAG,CAAC;IAC3B,mDAAmD;IACnD,MAAM,UAAU,SAAS,GAAG,CAAC,aAAa,SAAS,SAAS,GAAG,CAAC,cAAwB;IAExF,IAAI;QACF,MAAM,OAAO,4HAAE,CAAC,OAAO,CAAC,CAAC;;;IAGzB,CAAC;QAED,KAAK,GAAG,CAAC;YAAE;YAAW;YAAU;YAAK;YAAO;QAAQ;QAEpD,IAAA,uRAAc,EAAC;QACf,OAAO;YAAE,SAAS;YAAM,SAAS;QAAkC;IACrE,EAAE,OAAO,OAAY;QACnB,qDAAqD;QACrD,IAAI,MAAM,IAAI,KAAK,4BAA4B;YAC7C,OAAO;gBAAE,SAAS;gBAAO,SAAS;YAAqD;QACzF;QACA,OAAO;YAAE,SAAS;YAAO,SAAS,MAAM,OAAO;QAAC;IAClD;AACF;AAIO,eAAe,cAAc,SAAiB,EAAE,QAAkB;IACvE,MAAM,YAAY,SAAS,GAAG,CAAC;IAC/B,MAAM,WAAW,SAAS,GAAG,CAAC;IAC9B,MAAM,MAAM,SAAS,GAAG,CAAC;IACzB,MAAM,QAAQ,SAAS,GAAG,CAAC;IAC3B,MAAM,UAAU,SAAS,GAAG,CAAC,aAAa,SAAS,SAAS,GAAG,CAAC,cAAwB;IAExF,IAAI;QACF,MAAM,OAAO,4HAAE,CAAC,OAAO,CAAC,CAAC;;;;;;;;IAQzB,CAAC;QAED,KAAK,GAAG,CAAC;YAAE;YAAW;YAAU;YAAK;YAAO;YAAS;QAAU;QAE/D,IAAA,uRAAc,EAAC;QACf,OAAO;YAAE,SAAS;YAAM,SAAS;QAA+B;IAClE,EAAE,OAAO,OAAY;QACnB,IAAI,MAAM,IAAI,KAAK,4BAA4B;YAC7C,OAAO;gBAAE,SAAS;gBAAO,SAAS;YAAiD;QACrF;QACA,OAAO;YAAE,SAAS;YAAO,SAAS,MAAM,OAAO;QAAC;IAClD;AACF;AAIO,eAAe,cAAc,SAAiB;IACnD,IAAI;QACF,MAAM,OAAO,4HAAE,CAAC,OAAO,CAAC;QACxB,KAAK,GAAG,CAAC;QAET,IAAA,uRAAc,EAAC;QACf,OAAO;YAAE,SAAS;YAAM,SAAS;QAA+B;IAClE,EAAE,OAAO,OAAY;QACnB,uEAAuE;QACvE,0EAA0E;QAC1E,yEAAyE;QACzE,OAAO;YAAE,SAAS;YAAO,SAAS,MAAM,OAAO;QAAC;IAClD;AACF;;;IA/FsB;IAeA;IAMA;IA6BA;IAgCA;;AAlFA,uXAAA;AAeA,uXAAA;AAMA,uXAAA;AA6BA,uXAAA;AAgCA,uXAAA"}},
    {"offset": {"line": 178, "column": 0}, "map": {"version":3,"sources":["file:///home/daibbar/projects/CL0V/.next-internal/server/app/students/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getStudents as '0076e1ee761f3c725f60e6b94644d057cf1652cdf3'} from 'ACTIONS_MODULE0'\nexport {createStudent as '40852ca8bcc92030e1c2fec9a5d89cb0a554ab764e'} from 'ACTIONS_MODULE0'\nexport {updateStudent as '60a0ef4ce8b4795ac36b4acc6df890381a47990a1b'} from 'ACTIONS_MODULE0'\nexport {deleteStudent as '405fda7eb3a9b799d827ff4332611a9f0e62f6c74e'} from 'ACTIONS_MODULE0'\nexport {getMajors as '00fe3536568a6c117a4b57577e978eb83ea68f419d'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}