{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///home/daibbar/projects/CL0V/lib/db.ts"],"sourcesContent":["import Database from 'better-sqlite3';\nimport path from 'path';\n\nconst dbPath = path.join(process.cwd(), 'data', 'cl0v.db');\n\n// Prevent multiple instances of better-sqlite3 in development\nconst globalForDb = global as unknown as { db: Database.Database };\n\nconst db = globalForDb.db || new Database(dbPath, { verbose: console.log });\n\nif (process.env.NODE_ENV !== 'production') globalForDb.db = db;\n\ndb.pragma('foreign_keys = ON');\n\nexport default db;"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,SAAS,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,QAAQ;AAEhD,8DAA8D;AAC9D,MAAM;AAEN,MAAM,KAAK,YAAY,EAAE,IAAI,IAAI,sIAAQ,CAAC,QAAQ;IAAE,SAAS,QAAQ,GAAG;AAAC;AAEzE,wCAA2C,YAAY,EAAE,GAAG;AAE5D,GAAG,MAAM,CAAC;uCAEK"}},
    {"offset": {"line": 37, "column": 0}, "map": {"version":3,"sources":["file:///home/daibbar/projects/CL0V/actions/register-action.ts"],"sourcesContent":["'use server';\n\nimport { z } from 'zod';\nimport db from '@/lib/db';\nimport bcrypt from 'bcryptjs';\nimport { redirect } from 'next/navigation';\n\nconst RegisterSchema = z.object({\n  firstName: z.string().min(2, 'First name must be at least 2 characters'),\n  lastName: z.string().min(2, 'Last name must be at least 2 characters'),\n  email: z.string().email('Invalid email address'),\n  password: z.string().min(6, 'Password must be at least 6 characters'),\n  role: z.enum(['student', 'admin']),\n  cne: z.string().optional(),\n}).refine((data) => {\n  if (data.role === 'student' && !data.cne) {\n    return false;\n  }\n  return true;\n}, {\n  message: \"CNE is required for students\",\n  path: [\"cne\"],\n});\n\nexport type RegisterState = {\n  errors?: {\n    firstName?: string[];\n    lastName?: string[];\n    email?: string[];\n    password?: string[];\n    role?: string[];\n    cne?: string[];\n  };\n  message?: string | null;\n};\n\nexport async function registerUser(prevState: RegisterState, formData: FormData) {\n  const rawData = {\n    firstName: formData.get('firstName'),\n    lastName: formData.get('lastName'),\n    email: formData.get('email'),\n    password: formData.get('password'),\n    role: formData.get('role'),\n    // Convert null to undefined so Zod .optional() works correctly\n    cne: formData.get('cne') ? (formData.get('cne') as string) : undefined,\n  };\n\n  const validatedFields = RegisterSchema.safeParse(rawData);\n\n  if (!validatedFields.success) {\n    return {\n      errors: validatedFields.error.flatten().fieldErrors,\n      message: 'Missing Fields. Failed to Register.',\n    };\n  }\n\n  const { firstName, lastName, email, password, role, cne } = validatedFields.data;\n  const hashedPassword = await bcrypt.hash(password, 10);\n\n  try {\n    if (role === 'admin') {\n        const existingAdmin = db.prepare('SELECT 1 FROM admins WHERE email = ?').get(email);\n        if (existingAdmin) {\n            return { message: 'Email already in use.', errors: { email: ['Email already in use.'] } };\n        }\n        db.prepare(`\n          INSERT INTO admins (firstName, lastName, email, password, status)\n          VALUES (?, ?, ?, ?, 'pending')\n        `).run(firstName, lastName, email, hashedPassword);\n\n    } else {\n        // Student Registration\n        const existingStudent = db.prepare('SELECT 1 FROM students WHERE email = ? OR cne = ?').get(email, cne);\n        if (existingStudent) {\n             return { message: 'Email or CNE already in use.', errors: { email: ['Email or CNE already in use.'] } };\n        }\n        \n        // Default Major ID to 1 (IID) or null if schema allows, but schema says INTEGER (nullable). \n        // Let's leave it null for now or user can update profile later.\n        db.prepare(`\n          INSERT INTO students (firstName, lastName, email, password, cne, majorId)\n          VALUES (?, ?, ?, ?, ?, NULL)\n        `).run(firstName, lastName, email, hashedPassword, cne);\n    }\n\n  } catch (error) {\n    console.error('Registration failed:', error);\n    return {\n      message: 'Database Error: Failed to Create Account.',\n    };\n  }\n\n  redirect('/login');\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AAAA;;;;;;;AAEA,MAAM,iBAAiB,iOAAC,CAAC,MAAM,CAAC;IAC9B,WAAW,iOAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IAC7B,UAAU,iOAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IAC5B,OAAO,iOAAC,CAAC,MAAM,GAAG,KAAK,CAAC;IACxB,UAAU,iOAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IAC5B,MAAM,iOAAC,CAAC,IAAI,CAAC;QAAC;QAAW;KAAQ;IACjC,KAAK,iOAAC,CAAC,MAAM,GAAG,QAAQ;AAC1B,GAAG,MAAM,CAAC,CAAC;IACT,IAAI,KAAK,IAAI,KAAK,aAAa,CAAC,KAAK,GAAG,EAAE;QACxC,OAAO;IACT;IACA,OAAO;AACT,GAAG;IACD,SAAS;IACT,MAAM;QAAC;KAAM;AACf;AAcO,eAAe,aAAa,SAAwB,EAAE,QAAkB;IAC7E,MAAM,UAAU;QACd,WAAW,SAAS,GAAG,CAAC;QACxB,UAAU,SAAS,GAAG,CAAC;QACvB,OAAO,SAAS,GAAG,CAAC;QACpB,UAAU,SAAS,GAAG,CAAC;QACvB,MAAM,SAAS,GAAG,CAAC;QACnB,+DAA+D;QAC/D,KAAK,SAAS,GAAG,CAAC,SAAU,SAAS,GAAG,CAAC,SAAoB;IAC/D;IAEA,MAAM,kBAAkB,eAAe,SAAS,CAAC;IAEjD,IAAI,CAAC,gBAAgB,OAAO,EAAE;QAC5B,OAAO;YACL,QAAQ,gBAAgB,KAAK,CAAC,OAAO,GAAG,WAAW;YACnD,SAAS;QACX;IACF;IAEA,MAAM,EAAE,SAAS,EAAE,QAAQ,EAAE,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE,GAAG,EAAE,GAAG,gBAAgB,IAAI;IAChF,MAAM,iBAAiB,MAAM,yMAAM,CAAC,IAAI,CAAC,UAAU;IAEnD,IAAI;QACF,IAAI,SAAS,SAAS;YAClB,MAAM,gBAAgB,4HAAE,CAAC,OAAO,CAAC,wCAAwC,GAAG,CAAC;YAC7E,IAAI,eAAe;gBACf,OAAO;oBAAE,SAAS;oBAAyB,QAAQ;wBAAE,OAAO;4BAAC;yBAAwB;oBAAC;gBAAE;YAC5F;YACA,4HAAE,CAAC,OAAO,CAAC,CAAC;;;QAGZ,CAAC,EAAE,GAAG,CAAC,WAAW,UAAU,OAAO;QAEvC,OAAO;YACH,uBAAuB;YACvB,MAAM,kBAAkB,4HAAE,CAAC,OAAO,CAAC,qDAAqD,GAAG,CAAC,OAAO;YACnG,IAAI,iBAAiB;gBAChB,OAAO;oBAAE,SAAS;oBAAgC,QAAQ;wBAAE,OAAO;4BAAC;yBAA+B;oBAAC;gBAAE;YAC3G;YAEA,6FAA6F;YAC7F,gEAAgE;YAChE,4HAAE,CAAC,OAAO,CAAC,CAAC;;;QAGZ,CAAC,EAAE,GAAG,CAAC,WAAW,UAAU,OAAO,gBAAgB;QACvD;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO;YACL,SAAS;QACX;IACF;IAEA,IAAA,yUAAQ,EAAC;AACX;;;IAzDsB;;AAAA,uXAAA"}},
    {"offset": {"line": 147, "column": 0}, "map": {"version":3,"sources":["file:///home/daibbar/projects/CL0V/.next-internal/server/app/register/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {registerUser as '6008ac0d4df003d4fff82fc9efe8ea402769a13f62'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}