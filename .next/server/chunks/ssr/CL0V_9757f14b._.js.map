{"version":3,"sources":["../../../../../CL0V/actions/club-actions.ts","../../../../../CL0V/.next-internal/server/app/%28dashboard%29/clubs/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["'use server'\n\nimport db from '@/lib/db';\nimport { Club } from '@/types/db';\nimport { revalidatePath } from 'next/cache';\n\n// --- CREATE ---\nexport async function createClub(formData: FormData) {\n  const clubName = formData.get('clubName') as string;\n  const category = formData.get('category') as string;\n  const description = formData.get('description') as string;\n  const createdAt = formData.get('createdAt') as string;\n\n  try {\n    const stmt = db.prepare(`\n      INSERT INTO clubs (clubName, category, description, createdAt)\n      VALUES (@clubName, @category, @description, @createdAt)\n    `);\n\n    stmt.run({ clubName, category, description, createdAt });\n    \n    // Refresh the page data\n    revalidatePath('/clubs');\n    return { success: true, message: 'Club created successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\n// --- READ (Optional, usually done directly in Server Components) ---\nexport async function getClubs() {\n  const clubs = db.prepare('SELECT * FROM clubs ORDER BY createdAt DESC').all() as Club[];\n  return clubs;\n}\n\n// --- UPDATE ---\nexport async function updateClub(clubId: number, formData: FormData) {\n  const clubName = formData.get('clubName') as string;\n  const category = formData.get('category') as string;\n  const description = formData.get('description') as string;\n  const createdAt = formData.get('createdAt') as string;\n\n  try {\n    const stmt = db.prepare(`\n      UPDATE clubs \n      SET clubName = @clubName, \n          category = @category, \n          description = @description, \n          createdAt = @createdAt\n      WHERE clubId = @clubId\n    `);\n\n    stmt.run({ clubName, category, description, createdAt, clubId });\n\n    revalidatePath('/clubs');\n    return { success: true, message: 'Club updated successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\n// --- DELETE ---\nexport async function deleteClub(clubId: number) {\n  try {\n    const stmt = db.prepare('DELETE FROM clubs WHERE clubId = ?');\n    stmt.run(clubId);\n\n    revalidatePath('/clubs');\n    return { success: true, message: 'Club deleted successfully' };\n  } catch (error: any) {\n    return { success: false, message: error.message };\n  }\n}\n\n// --- GET CLUBS BY EVENT ---\nexport async function getClubsByEvent(eventId: number) {\n  try {\n    const clubs = db.prepare(`\n      SELECT c.*\n      FROM clubs c\n      JOIN eventOrganizers eo ON c.clubId = eo.clubId\n      WHERE eo.eventId = ?\n    `).all(eventId);\n\n    return clubs || [];\n  } catch (error: any) {\n    console.error(\"Failed to fetch clubs for event:\", error);\n    return [];\n  }\n}\n\n// --- CLUB MEMBERSHIPS ---\nexport async function getClubMembers(clubId: number) {\n  try {\n    const members = db.prepare(`\n      SELECT s.*, cm.joinedAt\n      FROM students s\n      JOIN clubMemberships cm ON s.studentId = cm.studentId\n      WHERE cm.clubId = ?\n      ORDER BY cm.joinedAt DESC\n    `).all(clubId);\n    \n    return members;\n  } catch (error: any) {\n    console.error(\"Failed to fetch club members:\", error);\n    return [];\n  }\n}\n\nexport async function getClubEvents(clubId: number) {\n  try {\n    // Events where the club is an organizer\n    const events = db.prepare(`\n      SELECT e.*\n      FROM events e\n      JOIN eventOrganizers eo ON e.eventId = eo.eventId\n      WHERE eo.clubId = ?\n      ORDER BY e.startDate DESC\n    `).all(clubId);\n    return events;\n  } catch (error) {\n    console.error(\"Failed to fetch club events:\", error);\n    return [];\n  }\n}\n\nexport async function getClubActivities(clubId: number) {\n  try {\n    // Activities owned by the club\n    const activities = db.prepare(`\n      SELECT * FROM activities WHERE clubId = ? ORDER BY startDate DESC\n    `).all(clubId);\n    return activities;\n  } catch (error) {\n     console.error(\"Failed to fetch club activities:\", error);\n     return [];\n  }\n}\n\nexport async function getClubMemberships() {\n  try {\n    const rows = db.prepare(`\n      SELECT cm.membershipId, cm.joinedAt,\n             c.clubName as clubName, c.category as clubCategory,\n             s.studentId, s.firstName || ' ' || s.lastName as studentName, s.cne as studentCne, s.email as studentEmail\n      FROM clubMemberships cm\n      JOIN clubs c ON cm.clubId = c.clubId\n      JOIN students s ON cm.studentId = s.studentId\n      ORDER BY cm.joinedAt DESC\n    `).all();\n\n    return rows || [];\n  } catch (error: any) {\n    console.error('Failed to fetch club memberships', error);\n    return [];\n  }\n}\n\nexport async function createClubMembership(formData: FormData) {\n  const studentId = parseInt(formData.get('studentId') as string);\n  const clubId = parseInt(formData.get('clubId') as string);\n  const joinedAt = (formData.get('joinedAt') as string) || new Date().toISOString();\n\n  try {\n    const stmt = db.prepare(`\n      INSERT INTO clubMemberships (joinedAt, clubId, studentId)\n      VALUES (@joinedAt, @clubId, @studentId)\n    `);\n\n    stmt.run({ joinedAt, clubId, studentId });\n    revalidatePath('/memberships');\n    return { success: true };\n  } catch (error: any) {\n    console.error('Failed to create club membership', error);\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function deleteClubMembership(membershipId: number) {\n  try {\n    const stmt = db.prepare('DELETE FROM clubMemberships WHERE membershipId = ?');\n    stmt.run(membershipId);\n    revalidatePath('/memberships');\n    return { success: true };\n  } catch (error: any) {\n    console.error('Failed to delete club membership', error);\n    return { success: false, message: error.message };\n  }\n}","export {logout as '00f497f1f80dfe93943451c06664f4127784cb3b2c'} from 'ACTIONS_MODULE0'\nexport {createClub as '40cc7ee1355da82c16e371972e28f7e30849d71969'} from 'ACTIONS_MODULE1'\nexport {updateClub as '60cee25155eb268da38739ba2e407d54bb593b1df7'} from 'ACTIONS_MODULE1'\nexport {deleteClub as '405b392b39a10b6121ccadaa05f71f247ebe3ed014'} from 'ACTIONS_MODULE1'\nexport {getClubs as '00e1ea61c1c9e73b2b6038b22b957d4558fcf03f9a'} from 'ACTIONS_MODULE1'\nexport {getClubMembers as '4093cad3ee0ecc3b0fef2e61956b43f07c74a082a5'} from 'ACTIONS_MODULE1'\nexport {getClubEvents as '4067996a687fa4cdbc7335e58587de60a556e5ae59'} from 'ACTIONS_MODULE1'\nexport {getClubActivities as '40c8af38a81f3624f6b01079a706aa468b028c92a6'} from 'ACTIONS_MODULE1'\n"],"names":[],"mappings":"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"}