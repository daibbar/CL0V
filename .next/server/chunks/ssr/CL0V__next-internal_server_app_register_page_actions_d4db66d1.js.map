{"version":3,"sources":["../../../../../CL0V/actions/register-action.ts"],"sourcesContent":["'use server';\n\nimport { z } from 'zod';\nimport db from '@/lib/db';\nimport bcrypt from 'bcryptjs';\nimport { redirect } from 'next/navigation';\n\nconst RegisterSchema = z.object({\n  firstName: z.string().min(2, 'First name must be at least 2 characters'),\n  lastName: z.string().min(2, 'Last name must be at least 2 characters'),\n  email: z.string().email('Invalid email address'),\n  password: z.string().min(6, 'Password must be at least 6 characters'),\n});\n\nexport type RegisterState = {\n  errors?: {\n    firstName?: string[];\n    lastName?: string[];\n    email?: string[];\n    password?: string[];\n  };\n  message?: string | null;\n};\n\nexport async function registerAdmin(prevState: RegisterState, formData: FormData) {\n  const validatedFields = RegisterSchema.safeParse({\n    firstName: formData.get('firstName'),\n    lastName: formData.get('lastName'),\n    email: formData.get('email'),\n    password: formData.get('password'),\n  });\n\n  if (!validatedFields.success) {\n    return {\n      errors: validatedFields.error.flatten().fieldErrors,\n      message: 'Missing Fields. Failed to Register.',\n    };\n  }\n\n  const { firstName, lastName, email, password } = validatedFields.data;\n  const hashedPassword = await bcrypt.hash(password, 10);\n\n  try {\n    // Check if email already exists\n    const existingAdmin = db.prepare('SELECT 1 FROM admins WHERE email = ?').get(email);\n    if (existingAdmin) {\n        return {\n            message: 'Email already in use.',\n            errors: { email: ['Email already in use.'] }\n        };\n    }\n\n    db.prepare(`\n      INSERT INTO admins (firstName, lastName, email, password, status)\n      VALUES (?, ?, ?, ?, 'pending')\n    `).run(firstName, lastName, email, hashedPassword);\n  } catch (error) {\n    console.error('Registration failed:', error);\n    return {\n      message: 'Database Error: Failed to Create Admin.',\n    };\n  }\n\n  redirect('/login');\n}\n"],"names":[],"mappings":"wDAEA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,mBAEA,IAAM,EAAiB,EAAA,CAAC,CAAC,MAAM,CAAC,CAC9B,UAAW,EAAA,CAAC,CAAC,MAAM,GAAG,GAAG,CAAC,EAAG,4CAC7B,SAAU,EAAA,CAAC,CAAC,MAAM,GAAG,GAAG,CAAC,EAAG,2CAC5B,MAAO,EAAA,CAAC,CAAC,MAAM,GAAG,KAAK,CAAC,yBACxB,SAAU,EAAA,CAAC,CAAC,MAAM,GAAG,GAAG,CAAC,EAAG,yCAC9B,GAYO,eAAe,EAAc,CAAwB,CAAE,CAAkB,EAC9E,IAAM,EAAkB,EAAe,SAAS,CAAC,CAC/C,UAAW,EAAS,GAAG,CAAC,aACxB,SAAU,EAAS,GAAG,CAAC,YACvB,MAAO,EAAS,GAAG,CAAC,SACpB,SAAU,EAAS,GAAG,CAAC,WACzB,GAEA,GAAI,CAAC,EAAgB,OAAO,CAC1B,CAD4B,KACrB,CACL,OAAQ,EAAgB,KAAK,CAAC,OAAO,GAAG,WAAW,CACnD,QAAS,qCACX,EAGF,GAAM,WAAE,CAAS,UAAE,CAAQ,CAAE,OAAK,UAAE,CAAQ,CAAE,CAAG,EAAgB,IAAI,CAC/D,EAAiB,MAAM,EAAA,OAAM,CAAC,IAAI,CAAC,EAAU,IAEnD,GAAI,CAGF,GADsB,CAClB,CADkB,OAAE,CAAC,MACN,CADa,CAAC,wCAAwC,GAAG,CAAC,GAEzE,MAAO,CACH,QAAS,wBACT,OAAQ,CAAE,MAAO,CAAC,wBAAwB,AAAC,CAC/C,EAGJ,EAAA,OAAE,CAAC,OAAO,CAAC,CAAC;;;IAGZ,CAAC,EAAE,GAAG,CAAC,EAAW,EAAU,EAAO,EACrC,CAAE,MAAO,EAAO,CAEd,OADA,QAAQ,KAAK,CAAC,uBAAwB,GAC/B,CACL,QAAS,yCACX,CACF,CAEA,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,SACX,iCAxCsB,IAAA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA"}