{"version":3,"sources":["../../../../../CL0V/actions/dashboard-actions.ts","../../../../../CL0V/.next-internal/server/app/%28dashboard%29/dashboard/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["'use server'\n\nimport db from '@/lib/db';\nimport { Activity, Club } from '@/types/db';\n\nexport async function getDashboardStats() {\n  try {\n    const clubCount = (db.prepare('SELECT COUNT(*) as count FROM clubs').get() as { count: number }).count;\n    \n    // Upcoming events (start date >= today)\n    const upcomingEventsCount = (db.prepare(\"SELECT COUNT(*) as count FROM events WHERE startDate >= date('now')\").get() as { count: number }).count;\n    \n    // Active students: students who are members of at least one club\n    const activeStudentsCount = (db.prepare('SELECT COUNT(DISTINCT studentId) as count FROM clubMemberships').get() as { count: number }).count;\n    \n    const activityCount = (db.prepare('SELECT COUNT(*) as count FROM activities').get() as { count: number }).count;\n\n    return {\n      clubCount,\n      upcomingEventsCount,\n      activeStudentsCount,\n      activityCount\n    };\n  } catch (error) {\n    console.error(\"Failed to fetch dashboard stats:\", error);\n    return {\n      clubCount: 0,\n      upcomingEventsCount: 0,\n      activeStudentsCount: 0,\n      activityCount: 0\n    };\n  }\n}\n\nexport async function getRecentActivities() {\n  try {\n    // Fetch last 5 activities created/updated or starting soon? \n    // Usually \"Recent Activities\" on a dashboard means \"what's happening recently or soon\".\n    // Let's go with the most recently created (highest ID usually implies creation if autoincrement) \n    // OR sorted by startDate DESC. Let's do startDate DESC to show latest things happening.\n    const activities = db.prepare(`\n      SELECT activityName as name, type, startDate as time\n      FROM activities \n      ORDER BY startDate DESC \n      LIMIT 5\n    `).all() as { name: string, type: string, time: string }[];\n    \n    return activities.map(a => ({\n        ...a,\n        // Format the date for display\n        time: new Date(a.time).toLocaleDateString(undefined, { month: 'short', day: 'numeric', year: 'numeric' })\n    }));\n  } catch (error) {\n    console.error(\"Failed to fetch recent activities:\", error);\n    return [];\n  }\n}\n\nexport async function getClubCategoryStats() {\n  try {\n    const totalClubs = (db.prepare('SELECT COUNT(*) as count FROM clubs').get() as { count: number }).count;\n    \n    if (totalClubs === 0) return [];\n\n    const stats = db.prepare(`\n      SELECT category, COUNT(*) as count\n      FROM clubs\n      GROUP BY category\n    `).all() as { category: string, count: number }[];\n\n    return stats.map(stat => ({\n      category: stat.category,\n      count: stat.count,\n      percentage: Math.round((stat.count / totalClubs) * 100)\n    }));\n  } catch (error) {\n    console.error(\"Failed to fetch club category stats:\", error);\n    return [];\n  }\n}\n\nexport async function getEngagementMetrics() {\n    try {\n        const totalStudents = (db.prepare('SELECT COUNT(*) as count FROM students').get() as { count: number }).count;\n        const activeStudents = (db.prepare('SELECT COUNT(DISTINCT studentId) as count FROM clubMemberships').get() as { count: number }).count;\n        \n        const engagementRate = totalStudents > 0 ? Math.round((activeStudents / totalStudents) * 100) : 0;\n\n        // Calculate event attendance rate (unique students participating in events / total students)\n        const eventParticipants = (db.prepare('SELECT COUNT(DISTINCT studentId) as count FROM eventParticipants').get() as { count: number }).count;\n        const eventAttendanceRate = totalStudents > 0 ? Math.round((eventParticipants / totalStudents) * 100) : 0;\n\n        return {\n            engagementRate,\n            eventAttendanceRate\n        };\n    } catch (error) {\n        console.error(\"Failed to fetch engagement metrics:\", error);\n        return { engagementRate: 0, eventAttendanceRate: 0 };\n    }\n}\n","export {logout as '00f497f1f80dfe93943451c06664f4127784cb3b2c'} from 'ACTIONS_MODULE0'\nexport {getRecentActivities as '001e92913d8dc0a5a782079b3017fc29dbb70e4a26'} from 'ACTIONS_MODULE1'\nexport {getEngagementMetrics as '00b629f1cdf4ae63959a4a881175023ef544019203'} from 'ACTIONS_MODULE1'\nexport {getClubCategoryStats as '00d1489e94ef8ba8128b05079e7eb267852b615fda'} from 'ACTIONS_MODULE1'\nexport {getDashboardStats as '00e9313c688735049738066bc40cc0582a72ec7bbb'} from 'ACTIONS_MODULE1'\n"],"names":[],"mappings":"wDAEA,EAAA,EAAA,CAAA,CAAA,OAGO,eAAe,IACpB,GAAI,CACF,IAAM,EAAa,EAAA,OAAE,CAAC,OAAO,CAAC,uCAAuC,GAAG,GAAyB,KAAK,CAGhG,EAAuB,EAAA,OAAE,CAAC,OAAO,CAAC,uEAAuE,GAAG,GAAyB,KAAK,CAG1I,EAAuB,EAAA,OAAE,CAAC,OAAO,CAAC,kEAAkE,GAAG,GAAyB,KAAK,CAErI,EAAiB,EAAA,OAAE,CAAC,OAAO,CAAC,4CAA4C,GAAG,GAAyB,KAAK,CAE/G,MAAO,WACL,sBACA,sBACA,gBACA,CACF,CACF,CAAE,MAAO,EAAO,CAEd,OADA,QAAQ,KAAK,CAAC,mCAAoC,GAC3C,CACL,UAAW,EACX,oBAAqB,EACrB,oBAAqB,EACrB,cAAe,CACjB,CACF,CACF,CAEO,eAAe,IACpB,GAAI,CAYF,OAAO,AAPY,EAAA,OAAE,CAAC,OAAO,CAAC,CAAC;;;;;IAK/B,CAAC,EAAE,GAAG,GAEY,GAAG,CAAC,IAAK,AAAC,CACxB,GAAG,CAAC,CAEJ,KAAM,IAAI,KAAK,EAAE,IAAI,EAAE,kBAAkB,MAAC,EAAW,CAAE,MAAO,QAAS,IAAK,UAAW,KAAM,SAAU,GAC3G,CAAC,CACH,CAAE,MAAO,EAAO,CAEd,OADA,QAAQ,KAAK,CAAC,qCAAsC,GAC7C,EAAE,AACX,CACF,CAEO,eAAe,IACpB,GAAI,CACF,IAAM,EAAc,EAAA,OAAE,CAAC,OAAO,CAAC,uCAAuC,GAAG,GAAyB,KAAK,CAEvG,GAAI,AAAe,MAAG,MAAO,EAAE,CAQ/B,OANc,AAMP,EANO,OAAE,CAAC,OAAO,CAAC,CAAC;;;;IAI1B,CAAC,EAAE,GAAG,GAEO,GAAG,CAAC,IAAS,CACxB,EADuB,OACb,EAAK,QAAQ,CACvB,MAAO,EAAK,KAAK,CACjB,WAAY,KAAK,KAAK,CAAE,EAAK,KAAK,CAAG,EAAc,KACrD,CAAC,CACH,CAAE,MAAO,EAAO,CAEd,OADA,QAAQ,KAAK,CAAC,uCAAwC,GAC/C,EAAE,AACX,CACF,CAEO,eAAe,IAClB,GAAI,CACA,IAAM,EAAiB,EAAA,OAAE,CAAC,OAAO,CAAC,0CAA0C,GAAG,GAAyB,KAAK,CACvG,EAAkB,EAAA,OAAE,CAAC,OAAO,CAAC,kEAAkE,GAAG,GAAyB,KAAK,CAEhI,EAAiB,EAAgB,EAAI,KAAK,KAAK,CAAE,EAAiB,EAAiB,KAAO,EAG1F,EAAqB,EAAA,OAAE,CAAC,OAAO,CAAC,oEAAoE,GAAG,GAAyB,KAAK,CACrI,EAAsB,EAAgB,EAAI,KAAK,KAAK,CAAE,EAAoB,EAAiB,KAAO,EAExG,MAAO,gBACH,sBACA,CACJ,CACJ,CAAE,MAAO,EAAO,CAEZ,OADA,QAAQ,KAAK,CAAC,sCAAuC,GAC9C,CAAE,eAAgB,EAAG,oBAAqB,CAAE,CACvD,CACJ,0CA/FsB,EA6BA,EAwBA,EAuBA,IA5EA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,MA6BA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,MAwBA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,MAuBA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,qJCjFtB,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA"}